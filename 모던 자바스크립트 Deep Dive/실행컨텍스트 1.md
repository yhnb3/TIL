## 실행컨텍스트

실행 컨텍스트는 자바스크립트의 동작 원리를 담고 있는 핵심 개념이다. 실행 컨텍스트를 바르게 이해하면 자바스크립트의 대부분을 이해할 수 있을 것이다.

### 소스코드의 타입

소스코드는 전역, 함수, eval, 모듈로 이루어져 있고 이렇게 구분하는 이유는 타입에 따라 실행컨텍스트를 생성하는 과정과 관리 내용이 다르기 때문이다.

### 소스코드의 평가와 실행

자바스크립트 엔진은 소스코드를 2개의 과정, 즉 "소스코드의 평가"와 "소스코드의 샐행"과정으로 나누어 처리한다.

소스코드의 평가 과정에서 실행 컨텍스트를 생성하고 변수, 함수 등의 선언문만 먼저 실행하여 생성된 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프에 등록한다.

소스코드 평가 과정이 끝나면 비로소 선언문을 제외한 소스코드가 순차적으로 실행되기 시작한다. 즉, 런타임이 시작된다. 평가 과정에서 등록한 스코프를 이용하며 변수 값의 변경과 같은 것은 스코프에 등록된다.

#### 예)

```js
var x;
x = 1;
```

1. 소스코드 평가 과정에서 변수 선언문인 `var x;`를 먼저 실행합니다. 이때 생성된 변수 식별자 x는 실행 컨텍스트가 간리하는 스코프에 등록되고 `undefined`로 초기화 됩니다.
2. 평가 과정이 끝이 나고 실행 과정에서 변수 할당문인 `x = 1`이 실행되고 이때 `x`변수가 스코프에 선언되어 있는 변수인지를 먼저 확인해야한다. x 변수가 실행 컨텍스트가 관리하는 스코프에 등록되어 있다면 x 변수에 값이 할당되어 관리되는 것이다.

### 실행 컨텍스트의 역할

자바스크립트는 여러가지 함수와 전역 환경에서 여러가지 코드가 일목요연하고 순서대로 실행되어야 합니다. 그러기 위해서는 스코프, 식별자, 코드 실행 순서등의 관리가 필요합니다.

1. 선언에 의해 생성된 모든 식별자(변수, 함수, 클래스 등)를 스코프를 구분하여 등록하고 상태변화를 지속적으로 관리할 수 있어야 합니다.
2. 스코프는 중첩 관계에 의해 스코프 체인을 형성해야 합니다. 즉, 스코프 체인을 통해 상위 스코프로 이동하여 식별자를 검색할 수 있어야 합니다.
3. 현재 실행 중인 코드의 실행순성를 변경 할 수 있어야하며 다시 돌아갈 수도 있어야합니다.

이 모든 것을 관리하는 것이 실행 컨텍스트 입니다.

식별자와 스코프는 실행 컨텍스트의 **렉시컬 환경**으로 관리하고 코드 실행 순서는 **실행 컨텍스트의 스택**으로 관리합니다.

### 실행 컨텍스트의 스택

```js
const x= 1;
function foo() {
    const y = 2;
    
    function bar() {
        const z = 3;
        console.log(x + y + z);
    }
    bar();
}

foo();
```

다음의 자바스크립트 파일을 실행하면 3개의 실행 컨텍스트가 생성됩니다. 그리고 먼저 실행되는 실행컨텍스트가 스택 가장 아래에 쌓이게 됩니다.

먼저 전역 실행컨텍스트가 가장 아래 쌓이고 foo()  bar() 함수가 차례로 쌓이고 함수로 생성된 실행 컨텍스트는 모두 실행하면 스택에서 빠지게 되고 bar() foo() 전역의 순서로 빠지게 됩니다.

