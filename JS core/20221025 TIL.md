## 비동기성

### 프로그램 덩어리

자바스크립트 프로그램은 `.js` 파일 하나로도 작성할 수 있지만 보통은 여러 개의 덩이 곧 `지금` 실행중인 프로그램 덩이 하나 + `나중`에 실행할 프로그램 덩이들로 구성된다. 여기서 가장 일반적인 덩어리는 `함수`이다.

`나중`은 직후가 아니다. 풀이하자면 `지금`당장 끝낼 수 없다는 의미이다. 그래서 비동기적으로 처리되므로 프로그램이 중단되지 않는다.

```js
var data = ajax('http://some.url.1')

console.log(data)
// 보통 ajax의 결과는 data에 담지 못한다. 
```

AJAX는 `지금`요청했지만 `나중`에 결과 값을 받는다. `지금` 부터 `나중`을 기다리는 가장 간단한 방법은 `콜백함수`를 이용하는 것이다.

``` js
ajax('http://some.url.1', function myCb(data){
  
  console.log(data) // 데이터 출력 완료.
})
```

동기적인 ajax를 구현하는 것은 기술적으로 가능하지만 ajax의 `나중`을 기다리며 아무 것도 하지 못하게 UI가 얼어붙는 것은 사용자에게 좋지 않은 경험을 주게 되니 상상도 하지 않는 것이 좋다.

### 이벤트 루프

자바스크립트 엔진는 혼자서는 안되고 반드시 호스팅에서 실행됩니다. (가장 흔한 호스팅 환경이 바로 브라우저 입니다.) 

그러나 환경은 달라도 `스레드`는 공통이다. 여러 프로그램 덩어리를 시간에 따라 매 순간 한번씩 엔진을 실행시키는 `이벤트 루프`라는 장치이다.

다시말해, 자바스크립트 엔진은 애당초 시간이란 관념 따윈 없었고 임의의 자바스크립트 코드 조각을 시시각각 주는 대로 받아 처리하는 실행기 이며, `이벤트`를 스케줄링하는 일은 언제나 엔진을 감싸고 있는 주위 환경의 몫이었다.

> 이벤트 루프
>
> 간단하게 설명하면 이벤트 큐에 동기적인 코드들이 우선적으로 순서대로 쌓인다. 그리고 비동기 적인 코드들은 자바스크립트 외부환경(web api)와 같은 것들에 의해 비동기 처리가 끝이 나고 콜백함수를 실행해야 될 때가 오면 이벤트 큐의 맨 마지막에 쌓인다.

### 병렬 스레딩

`비동기`와 `병렬`은 아무렇게나 섞어 쓰는 경우가 많지만 그 의미는 완전히 다르다. 비동기는 `지금`과 `나중`의 간극에 관한 용어이며 `병렬`은 동시에 일어나는 일들과 연관된다.

이벤트 루프는 작업 단위로 나누어 차례대로 실행하지만 공유 메모리에 병렬로 접근하거나 변경할 수는 없다. 

