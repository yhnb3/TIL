## 데이터 링크 계층과 물리 계층

링크계층은 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하며 장치간에 신호를 주고 받는 '규칙'을 정하는 계층입니다.

- 데이터 링크 계층은 '이더넷 프레임'을 통해 에러확인, 흐름제어, 접근제어를 담당하는 계층을 말합니다. 

- 물리 계층은 무선, 유선LAN과 0과 1로 이루어진 데이터를 보내는 계층을 말함.

 ### 데이터 링크 계층

#### L2스위치

L2스위치는 장치들의 MAC 주소를 MAC 주소 테이블을 통해 관리하며 연결된 장치로부터 패킷이 왔을 때 패킷 전송을 담당합니다.

ip 주소를 이해하지 못해 IP 주소 기반으로 라우팅은 불가능 하며 단순히 패킷의 MAC주소를 읽어 스위칭 하는 역할을 합니다. 목적지가 MAC 주소 테이블에 없다면 전체 포트에 전달하고 MAC 주소 테이블의 주소는 일정시간 이후 삭제하는 기능도 있습니다.

#### 브릿지

브리지는 두개의 근거리 통신망을 상호 접속할 수 있도록 하는 통신망 연결 장치로 포트와 포트 사이의 다리 역할을 하며 장치에서 받아온 MAC 주소를 MAC 주소 테이블로 관리합니다.

브리지는 통신망 범위를 확장하고 서로 다른 LAN등으로 이루어진 '하나의' 통신망을 구축할 때 쓰입니다.

#### 이더넷 프레임

> 참고 정도만 하자

MAC 주소

컴퓨터나노트북 등 각 장치에는 네트워크에 연결하기 위한 장치가 있는데, 이른 구별하기 위한 식별벼ㅓㄴ호를 말한다. 6바이트로 구성된다.

## 물리 계층

### NIC

LAN카드라고 하는 네트워크 인터페이스 카드는 2대 이상의 컴퓨터 네트워크를 구성하는데 사용하며, 네트워크와 빠른 속도로 데이터를 송수신할 수 있도록 컴퓨터 내에 설치하는 확장 카드 입니다. 각 LAN카드에는 주민등록 번호처럼 각각을 구분하기 위한 고유의 MAC주소가 있습니다.

### 리피터

들어오는 약해진 신호정도를 증폭하여 다른 쪽으로 전달하는 장치를 말합니다. 이를 통해 패킷이 더 멀리 갈 수 있습니다. 하지만 이는 광케이블이 보급됨에 따라 현재는 잘 쓰이지 않는 장치입니다.

### AP(ACCESS POINT)

패킷을 복사하는 기기입니다. AP에 유선 LAN을 연결한후 다른 장치에서 무선 LAN기술을 사용하여 무선 네트워크 연결할 수 있습니다.(공유기?)

### 유선 LAN의 기술

#### 전이중화 통신

전이중화 통신은 양쪽 장치가 동시에 송수신할 수 있는 방식을 말합니다. 이는 송신로와 수신로로 나눠서 데이터를 주고 받으며 현대의 고속 이더넷은 이 방식을 기반으로 통신하고 있습니다.

유선랜은 IEEE802.3 이라는 프로토콜을 따릅니다.

#### CSMA/CD

반이중화 통신 

데이터를 보낸 이후 충돌이 발생한다면 일정 시간 이후에 재전송하는 방식을 말합니다. 수신로와 송신로를 각각둔것이 아니라 한 경로를 기반으로 데이터를 보내고 받기 때문에 충돌에 대비해야 했습니다.

#### 유선 랜을 이루는 케이블

TP 케이블 (트위스트 페어 케이블) ( 구리선으로 만듬 )

광섬유 케이블 ( 구리선이 아닌 레이저를 이용해 통신합니다.)

### 무선 LAN의 기술

#### 무선 LAN(IEEE802.11)

반이중화 통신 양쪽 장치는 서로 통신할 수 있지만 동시에는 할 수 없다.

#### CSMA/CA

반 이중화 통신 중 하나로 장치에서 데이터를 보내기 전에 캐리어 감지 등으로 사전에 가능한 한 충돌을 방지하는 방식을 사용하며 과정은 다음과 같이 이루어집니다.

1. 데이터를 송신하기 전에 무선 매체를 살핍니다.
2. 캐리어 감지 회선이 비어있는지를 판단합니다.
3. IFS 랜덤값을 기반으로 정해진 시간 만큼 기다리며, 만약 무선 매체가 사용 중이면 점차 그 간격을 늘려가며 기다립니다.
4. 이후에 데이터를 송신합니다.

#### 와이파이

전자기기들이 무선 LAN신호에 연결할 수 있게하는 기술로 AP가 있어야 합니다. 

#### BSS

기본 서비스 집합. 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS내에 있는 AP들과 장치들이 서로 통신이 가능한 구조를 말합니다. 근거리 무선 통신을 제공하고, 하나의 AP만을 기반으로 구축되어 있어 사용자가 한곳에서 다른 곳으로 자유롭게 이동하며 네트워크에 접속하는 것은 불가능합니다.

#### ESS

하나 이상으로 연결된 BSS 그룹입니다.

## 대규모 트래픽으로 인한 서버 과부화 해결 방법

### 서버 과부하의 의미

서버가 리스소를 소진하여 들어오는 요청을 처리하지 못할 때 발생. 사용자의 웹 요청을 처리하지 못해 응답없음이 뜨게 됩니다.

> 503 Server Unavailable
>
> No Server is available to handle this request

### 모니터링을 통한 자원 할당

서버의 cpu 사용량이 80~90%에 도달하거나 메모리가 부족해서 스와핑이 발생하면 과부화 상태가 됩니다.

이는 **모니터링을 통한 자원의 적절한 할당으로 해결합니다.**

#### AWS 오토 스케일링

애플리케이션을 모니터링하고 자원의 용량을 자동으로 조절합니다.

#### netdata를 이용한 모니터링

slack과 연동을 하여 임계치에 도달햇을때 알림을 통해 무언가 처리를 통해 문제를 해결 할 수 있다.

#### 모니터링의 중요성

- 어떤 페이지에 어떤 트래픽이 얼마나 발생했느냐
- 어떤 네트워크에서 병목현상이 일어났냐 등을 기준으로 해결할 수 있습니다.
- 모니터링을 하면 활동도가 낮은페이지, 높은 페이지를 파악 가능하여 서비스 개선에도 도움이 된다.

### 로드밸런서

AWS 오토 스케일링이 빠르고 편하긴 하지만 그래도 시간이 오래걸린다.

트래픽을 분산한다. 그리고 하나의 서버에 장애가 생기면 그 서버에 트래픽을 주지 않는다.

쉽게 생각하면 오토 스케일링 보다 선행되는 방법 인거 같다.

### 블랙스완 프로토콜

시스템이 다운되면 블랙스완 프로토콜을 발령하며 다음과 같은 수칙을 따릅니다.

1. 영향을 받은 시스템과 각 시스템의 상대적 위험 수준을 확인
   - 데이터를 수집하고 원인에 대한 가설을 수립 후 이를 테스팅
2. 잠재적으로 영향을 받을 수 있는 내부의 모든 팀에 연락
3. 최대한 빨리 취약점에 영향을 받는 모든 시스템을 패치
4. 복원 계획을 포함한 우리의 대응 과정을 파트너와 고객 등 외부에 전달

### 서킷 브레이커

실패를 허용하는 전략 => 에러가 연쇄적으로 퍼지는 것을 막는 것이 중요하기 때문에 서킷 브레이커도 중요하다.

외부 서비스의 장애로 인한 연쇄적인 장애로 인한 연쇄적 장애 전파를 막기 위해 자동으로 외부 서비스와 연결을 차단 및 복구하는 것을 말합니다.

보통 MSA를 할때 서킷 브레이커를 장착하는데요. MSA에서는 RPC나 HTTP나 gRPC를 기반으로 각각의 서비스들이 네트워크로 묶여 있습니다.

네트워크 중 하나가 갑자기 오류가 생기는 상황이 발생 하였을때 의존성이 있는 다른 서비스들 까지 연쇄적 으로 문제가 생길 수가 있습니다.

- closed : 네트워크 정상
- open : 임계치 이상의 상태. 요청을 전송하지 않고 바로 fail 반환
- half_open :  장애가 해결 되었나를 확인하기 위해 요청을 전송하여 응답확인 하여 open or closed 선택

### 컨텐츠를 확인하여 대규모 트래픽 최적화

1. 불필요한 컨텐츠 제거

   ex) 불필요한 쿼리 제거

2. CDN을 통해 컨텐츠 제공

   분산된 대규모 서버 네트워크를 기반으로 컨텐츠를 제공해서 메인 서버에 대한 부사를 줄입니다.

3. 컨텐츠 캐싱

   해당 트래픽이 발생하지 않게 하기 위해 브라우저 캐시를 통해 해당 요청에 관한 항목을 캐시가 해결할 수 있도록 한다.

4. 컨텐츠 압축

5. 컨텐츠의 우하한 저하

   서버가 네트워크 요청을 모두 해결하지 못할 경우 일시적으로 컨텐츠의 기능을 일시적으로 줄이는 전략입니다.

