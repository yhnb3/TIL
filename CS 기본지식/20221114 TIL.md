### TCP/IP 4계층 혹은 OSI 7계층

인터넷에서 컴퓨터들이 서로 정보를 주고 받는데 쓰이는 프로토콜의 집합을 설명한다.

TCP/IP 4계층 : 애플리케이션, 전송, 인터넷, 링크

OSI 계층: 애플리케이션, 프레젠테이션, 세션, 전송, 네트워크, 데이터링크, 물리 계층

각 계층들은 독립적으로 동작하며 다른 계층이 바뀌어도 아무 영향이 없다.

#### 애플리케이션

HTTP, FRP, SSH, SMTP, DNS 응용프로그램이 사용되는 계층

#### 전송계층

송신자와 수신자를 연결하는 통신 서비스를 제공하며 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공합니다. 애플리케이션과 인터넷 계층 사이의 교두보 역할을 한다.

연결 방식은 TCP, UDP가 있다.

TCP : 패킷사이 순서 보장 연결지향 신뢰성 구축 수신여부 확인 `가상회선패킷 교환 방식`

UDP : 순서를 보장하지 않고 수신여분 확인 안함 `데이터그램 패킷 교환 방식`

> 연결 : TCP 3 way handshake 
>
> 연결끊기 : TCP 4 way handshake
>
> 3way
>
> 1. 클라이언트가 서버로 자신의 ISN을 담은 SYN토큰을 보냄
> 2. 서버가 클라이언트에서 클라이언트의 ISN+1을 담은 ACK와 자신의 ISN을 담은 SYN을 보냄
> 3. 클라이언트가 서버한테 서버의 ISN+1을 담은 ACK를 보냄
>
> ISN은 항상 새로 만들어지는 난수 -> 예전의 연결과 다름을 보장하기 위해
>
> 4way
>
> 1. 클라이언트가 서버로 FIN 보냄.
> 2. 서버가  클라이언트에 ACK 보냄. 그리고 잠깐 기다림
> 3. 서버가 클라이언트에게 FIN을 보냄
> 4. 그럼 클라이언트가 ACK를 서버로 보냄. 그리고 잠시 있다가 연결 해제
>
> 왜 잠시 기다릴까? 지연 패킷이 발생할 경우 데이터 무결성을 지키기 위해 기다림.
>
> 두 장치가 연결이 닫혔는지 확인하기 위해. 제대로 닫히지 않은 상태에서 새로운 연결을 하려고 하면 문제가 생길 수 있다.

#### 인터넷 계층

장치로 받은 네트워크 패킷을 IP주소를 기반으로 지정된 목적지로 전달하는 과정

홉 바이 홉 통신 : 라우터를 통해 IP주소를 찾아 폴짝 폴짝 뛰어감 ㅋㅋ

#### 링크 계층

실제 전선 혹은 무선 등으로 데이터를 전달하며 장치 간의 신호를 주고 받는 규칙을 정하는 계층

### 캡슐화

애플리케이션 계층에서 전송 계층으로 보내는 요청 값들이 캡슐화 과정을 거쳐 전달되고 다시 전송계층에서 애플리케이션으로 올라오면서 비캡슐화 과정이 진행된다.

> 캡슐화란 계층을 지나면서 상위 계층의 헤더와 데이터를 데이터로 포함시키고 해당 계층의 헤더를 삽입하는 과정을 말합니다. 
>
> 캡슐화하는 이유는 정보를 은폐하기 위함이다.

### PDU

네트워크 계층을 거칠때 각 계층에서 이용되는 네트워크의 단위

애플리케이션 : 메시지

전송: 세그먼트(TCP), 데이터그램(UDP)

인터넷 : 패킷

전송 : 프레임, 비트

#### 네트워크 기기

네트워크 기기는 하위 계층을 처리 할 수 있지만 그 반대는 불가합니다.

애플리케이션 계층 : L7 스위치

인터넷 계층 : 라우터 L3스위치

데이터 링크 계층 L2 스위치, 브리지

물리 계층 NIC 리피터 AP

#### 애플리케이션 계층을 처리하는 기기

- L7 스위치

  스위치는 여러장비를 연결하고 데이터 통신을 중재하며 목적지가 연결된 포트로만 전기신호를 보내	며 데이터를 전송하는 통신 네트워크 장비

  로드밸런서 라고도 하며 서버의 부하를 분산한다.

  URL, 서버, 캐시 , 쿠키 등을 기반으로 트래픽을 분산한다.

- L4스위치와 L7스위치의 차이

  L4스위치도 로드밸런서 역할 가능 하지만 L4스위치는 인터넷 계층을 처리하는 기기로 스트리밍 관련 서비스에서는 사용할 수 없으며 메시지를 기반으로 인식하지 못하고 IP와 포트를 기반으로 트래픽을 분산

#### 인ㅌ넷 계층을 처리하는 기기

라우터와 L3스위치가 있다.

- 라우터

  여러개의 네트워크를 연결 분할 구분 시켜주는 역할

  다른 네트워크에 존재하는 장치끼리 서로 데이터를 주고 받을 때 패킷 소모를 최소화 하고 결로를 최적화 하여 최소 경로로 패킷을 포워딩 하는 라우팅을 하는 장비입니다.

- L3 스위치

  L2 스위치의 기능과 라우팅 기능을 갖춘 장비 라우터라고 해도 무방

  라우터는 소프트웨어 기반의 라우팅과 하드웨어 기반의 라우팅을 하는 것으로 나뉘고

  하드웨어 기반의 라우팅을 담당하는 것이 L3 스위치이다.

#### 데이터 링크 계층을 처리하는 기기

- L2 스취치

  장치들이 MAC 주소를 MAC 주소 테이블을 통해 관리하며 연결되 ㄴ장치로 패킷이 왓을대 패킷 전송 담당

  IP주소는 이해하지 못한다. 

- 브리지

  두 개의 근거리 통신만을 상호 접속할 수 잇도록 하는 통신망 연결 장치 포트와 포트 사이의 다리 역할을 한다.

#### 물리 계층을 처리하는 기기

- NIC

  흔히 말하는 랜카드 

- 리피터

  신호 증폭

- AP

  패킷을 복사하는 기기

### IP 주소

- ARP

  IP주소를 MAC주소로 찾는 다리 역할을 하는 프로토콜

  수 많은 연결된 물리적 장치에게  IP주소를 묻고 MAC 주소를 받아온다.

- 홉 바이홉

  각각의 라우터에 있는 라우팅 테이블의 IP를 기반으로 패킷을 전달하고 다시 전달해나갑니다.

  즉, 통신 장치에 있는 `라우팅 테이블`의 IP를 통해 시작 주소 부터 시작하여 다음 IP로 계속 해서 라우팅 과정을 거쳐 패킷이 최종 목적지 까지 도달하는 통신

- 라우팅 테이블

  라우터가 들어가 있는 목적지 정보와 그 목적지로 가기위한 방법이 들어 있는 리스트

- 주소 체계

  IPv4 : 32비트를 8비트 단위로 점으로 표기

  IPv6 : 64비트를 16비트 단위로 :으로 표기

### HTTP

- 1.0

  한 연결당 하난의 요청 -> RTT의 증가

  > RTT란
  >
  > 패킷이 목적지에 도달하고 나서 다시 돌아오는데 걸리는 패킷 왕복 시간

  RTT를 줄이기 위해 이미지 스플리팅, 코드 압축, 이미지 Base64 인코딩 사요

  - 이미지 스플리팅 -> 여러이미지를 한 이미지에 다 담아서 위치옮겨 가며 사용
  - 코드 압축 : 코드를 최대한 빡빡하게 만들기 -> 빈칸 혹은 줄바꿈 제거
  - base64 : 이미지를 코드로 바꿈 -> 근데 용량 커짐

- 1.1

   매번 TCP연결을 하는 것이 아니라 한번 초기화 하면 keep-alive라고 해서 여러개의 파일을 송수신 할 수 있게됨.

- 2

  - 멀티 플렉싱

    여러개의 스트름을 사용하여 송수신 

  - 헤더 압축

    1.x버전의 큰 헤더라는 문제를 해결

  - 서버 푸시

    html 을 서버에서 클라이언트로 보내면 자동으로 css파일도 푸시 왜냐하면 당연히 필요할 것이기 때문에.

#### HTTPS

HTTP/2는 HTTPS 위에서 동작. 애플리케이션계층과 전송 계층 사이에서 신뢰 계층은 SSL/TLS 계층을 넣은 신뢰할 수 잇는 HTTP 요청을 말한다. 이를 통해 통신을 암호화 한다.

- SSL/TLS

  SSL1.0부터 TLS까지 발전해 왔지만 SSL/TLS라고 부른다. 

  전송계층에서 보안을 제공하는 프로토콜

  클라이언트와 서버가 소통할때 중간에서 도청 또는 변조하지 못하게 막는다.

- 해싱 알고리즘

  데이터를 추정하기 힘든 더 작고, 섞여있는 조각으로 만드는 알고리즘

  SSL/TLS는 해싱 알고리즘으로  SHA-256과 SHA-384를 쓴다.

  - SHA-256

    함수의 결과값이 256비트인 알고리즘. 

- SEO에도 도움이 된다. 

  SSL 인증서를 가지고 있으면 더 SEO 순위가 높다(구글 피셜)

- 구축방법

  서버 앞단에 HTTPS를 제공하는 로드밸런설를 두거나

  HTTPS서비스를 구축하거나

  서버 앞단에 HTTPS를 제공하는 CDN을 두거나

- HTTP/3

  TCP위에서가 아닌 QUIC위에서 돌아가며 번거로운 3웨이 핸드셰이크를 안해도 된다.

  UDP기반이고 낮은 패킷 손실율을 자랄ㅇ한다. 순방향 오류 수정 메커니즘 이용

- 주소창에 WWW.NAVER.COM을 입력하면?

  1. 대기열에 추가 되고
  2. 캐싱 확인
  3. DNS로 IP 주소 받기
  4. 네트워크 연결
  5. 컨텐츠 다운로드
  6. HTML 파싱해서 DOM 트리만들기
  7. CSS 파싱해서 CSSOM 트리 만들기
  8. DOM트리와 CSSOM 트리로 렌더 트리 만들기
  9. 레이아웃 잡기
  10. 그리기
  11. 레이어 합치기
  12. 짜잔 화면 나오기

  

