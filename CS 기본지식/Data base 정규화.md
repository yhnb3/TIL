# Data base 정규화

### 1. 배경

한 릴레이션에서 여러 엔티티의 애트리뷰트들을 혼합하게 되면 정보가 중복 저장되며, 저장 공간을 낭비하게 된다. 또 중복된 정보로 인해 `갱신 이상`이 발생하게 된다. 동일한 정보를 한 릴레이션에는 변경하고, 나머지 릴레이션에서는 변경하지 않은 경우 어느 것이 정확한지 알 수 없게 되는 것이다. 이러한 문제를 해결하기 위해 정규화 과정을 거치는 것이다.

**1-1. 갱신 이상에는 어떤 것들이 있을까?**\

- 삽입이상

  원하지 않는 자료가 삽입된다던지, 삽입하는데 자료가 부족해 삽입이 되지 않는 문제점

- 삭제 이상

  하나의 자료만 삭제하고 싶지만, 그자료가 포함된 튜플 전체가 삭제 됨으로 원하지 않는 정보 손실이 발생하는 문제점을 말한다.

- 수정 이상

  정확하지 않거나 일부의 튜플만 갱신되어 정보가 모호해지거나 일관성이 없어져 정확한 정보 파악이 되지 않는 문제점을 말한다.

### 2. 정규화란 무엇인가?

관계형 데이터 베이스에서 중복을 최소화 하기 위해 데이터를 구조화하는 작업이다. 좀 더 구체적으로는 불만족 스러운 나쁜 릴레이션의 애트리뷰트들을 나누어서 좋은 작은 릴레이션으로 분해하는 작업을 말한다. 정규화 과정을 거치게 되면 정규형을 만족하게 된다. 정규형이란 특정 조건을 만족하는 릴레이션의 스키마 형태를 말하며 제 1 정규형, 제 2 정규형, 제 3 정규형, .. 등이 존재한다.

**2-1 나쁜 릴레이션이란?**

엔티티를 구성하고 있는 애트리뷰트 간에 함수적 송속성을 판단한다. 판단한 함수적 종속성은 좋은 릴레이션 설계의 정혁적 기준으로 사용된다. 즉, 각각의 정규형 마다 어떠한 함수적 종속성을 만족하는지에 따라 정규형이 정의되고, 그 정규형을 만족하지 못하는 정규형을 나쁜 릴레이션으로 파악한다.

**2-2 함수적 종속성이란?**

애트리뷰트 데이터들의 의미와 애트리뷰트들 간의 상호 관계로부터 유도되는 제약조건의 일종이다. X와 Y를 임의의 애트리뷰트 집합이라고 할때, X의 값이 Y의 값을 유일하게 결정한다면 "X는Y를 함수적으로 결정한다."라고 한다. 함수적 종속성은 실세계에서 존재하는 애트리뷰트들 사이의 제약 조건으로부터 유도된다. 또한 각종 추론 규칙에 따라서 애트리뷰트들 간의 함수적 종속성을 판단할 수 있다. 

**2-3 각각의 정규형은 어떤한 조건을 만족해야하는가?**

1. 분해 대상인 분해 집합 D는 `무손실 조인`을 보장해야한다.
2. 분해집합 D 는 합수적 종속성을 보존해야 한다.



### 제 1 정규형

애트리뷰트의 도메인이 오직 `원자값`만을 포함하고, 튜플의 모든 애트리뷰트가 도메인에 속하는 하나의 값을 가져야한다. 즉, 복합 애트리뷰트, 다중값 애트리뷰트, 중첩 릴레이션 등 비 원자적인 애트리뷰트들을 허용하지 않는 릴레이션 형태를 말한다.

> 제 1 정규형을 만족하지 않는 대표적인 경우에는 한 애트리뷰트가 도메인에 속하는 여러개의 값을 가지는 경우인데 이럴때는 그 애트리뷰트만을 위한 하나의 릴레이션을 더 만들어서 해결할 수 있다.

### 제  2 정규형

모든 비주요 애트리뷰트들이 주요 애트리뷰트에 대해서 완전 함수적 종속이면 제 2 정규형을 만족한다. 완전 함수적 종속이란 `X->Y`라고 가정했을때, X의 어떠한 애트리뷰트라도 제거하면 더 이상 함수적 종속성이 성립되지 않는 경우를 말한다. 즉, 키가 아닌 열들이 각각 후보키에 대해 결정되는 릴레이션 형태를 말한다. 

> 키가 아닌 애트리뷰트가 키와 함수적 종속적이 아닌 경우, 하나의 릴레이션을 더 만들어서 제 2 정규형을 만족 시켜야 합니다.

### 제 3 정규형

어떤한 비주요 애트리뷰트도 기본키에 대해 이행적으로 종속되지 않으면 제 3 정규형을 만족한다. 이행 함수적 종속이란 `X - > Y, Y -> Z =>  X - > Z`로 추론 될 수 있는 종속관계를 말한다. 즉, 비 주요 애트리뷰트가 비주요 애트리뷰트에 의해 종속되는 경우가 없는 릴레이션의 형태를 말한다.

> 즉 한 릴레이션에 종속적으로 결정되는 애트리뷰트가 하나만 존재해야합니다. `갑 - 을` 관계만 존재해야하며`을 - 병`의 관계는 존재해서는 안됩니다.

### BCNF 정규형

여러 후보키가 존재하는 릴에이션에 해당하는 정규화 내용입니다. 복잡한 식별자 관계에 의해 발생하는 문제를 해결하기 위해 제 3 정규형을 보완하는데 의미가 있습니다. 비주요 애트리뷰트가 후보키의 일부를 결정하는 분해나는 과정을 말합니다.

- 모든 제 2 정규형은 제 1 정규형을 만족한다.
- 모든 제 3 정규형은 제 2 정규형을 만족한다.
- BCNF 정규형은 제 3 정규형을 만족한다.

수많은 정규형이 있지만 관계 데이터 베이스 설계의 목표는 각 릴레이션이 3NF를 갖게하는 것이다.

### 정규화의 장점

1. 데이터베이스 변경시 이상현상을 해결가능
2. 데이터베이스 구조 확장 시 재 디자인 최소화 정규화된 데이터베이스 구조에서는 새로운 데이터 형의 추가로 인한 확장 시, 그 구조를 변경하지 않아도 되거나 일부만 변경해도 된다. 이는 데이터베이스와 연동된 응용 프로그램에 최소한의 영향만을 미치게 되며 응용 프로그램의 생명을 연장 시킨다.
3. 사용자 에게 데이터 모델을 더욱 의미있게 제공한다. 정규화된 테이블들과 정규화된 테이블들 간의 관계들은 현실 세계에서의 개념들과 그들간의 관계들을 반영한다.

### 단점은?

릴레이션 분해로 인한 연산이 많아진다. 이로 인해 질의응답 시간이 느려질 수 있다. 정규화를 수행하는 것은 결정자에 의해 함수적 종속을 가지고 있는 일반 속성을 의존자로 하여 이상 현상을 제거하는 것이다. 데이터의 중복 속성을 제거하고 결정자에 의해 동일한 의미를 일반속성이 하나의 테이블로 집야고디므로 한 테이블의 데이터 용량이 최소화 되는 형과가 있다. 따라서 정규화된 테이블은 처리할 때 속도가 빨라질수도 느려질 수도 있다.

### 어떤 상황에서 정규화를 해야할까?

조회를 하는 SQL문장에서 많은 조인으로 인해 성능하락이 생긴다면 반정규화를 할 필요가 있다.

**반정규화**

정규화된 엔티티 속성 관계를 시스템의 성능 향상 및 개발과 운영의 반순화를 위해 중복 통합, 분리 등을 수행하는 데이터 모델링 기법. 일반적으로 조회에 대한 처리의 성능이 중요하다고 판단될때 부분적으로 반정규화를 고려하게 된다.

**5-1 무엇이 반정규화의 대상인가?**

1. 자주 사용되는 테이블에 액세스하는 프로세스의 수가 가장 많고, 항상 일정한 범위만을 조회하는 경우
2. 테이블에 대량 데이터가 있고 대량의 범위를 자주 처리하는 경우, 성능상 이슈가 있을 경우
3. 테이블에 지나치게 조인을 많이 사용하게 되어 데이터를 조회하는 것이 기술적으로 어려울 경우

**5-2 반정규화 과정에서 주의해야할점**

반정규화를 과도하게 하다보면 데이터의 무결성이 깨질 수 있다. 입력, 수정, 삭제의 질의문에 대한 응답이 느려질 수 있다.