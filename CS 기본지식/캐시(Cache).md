# 캐시(Cache)

> 컴퓨터의 성능을 향상시키기 위해 사용되는 메모리 . 이미 가져온 데이터나 계산된 결과값의 복사본을 저장함으로써 처리 속도 향상. 대부분의 프로그램이 동일한 데이터나 명령어에 반복해서 액세스하기 때문에 캐싱은 효율적인 아키텍처 패턴이다.

## 웹 캐시(Web Cache)

> 사용자가 웹 사이트에 접속할 때, 정적 컨텐츠를 특정 위치에 저장하여, 웹사이트 서버에 해당 컨텐츠를 매번 요청하여 받는 것이 아니라, 특정 위치에서 불러옴으로써 사이트 응답시간을 줄이고, 서버 트래픽 감소 효과를 볼 수 있다.

### 종류

1. Browser Caches
   - 브라우저 또는 HTTP요청을 하는 Client Application에 의해 내부 디스크에 캐쉬
   - Cache된 Resource를 공휴하지 않는 한 개인에 한정된 Cache
   - 브라우저의 Back버튼 또는 이미 방문한 페이지를 재 방문하는 경우 극대화
2. Proxy Caches
   - Browser Cache와 동일한 원리로 동작하며 Client나 Server가 아닌 네트웨크 상에서 동작
   - 큰 회사나 IPS의 방화벽에 설치 되며 대기시간 & 트래픽 감소, 접근정책 & 제한 우회, 사용률 기록등 수행
   - 한정된 수의 클라이언트를 위하여 무한대의 웹서버의 컨텐츠를 캐쉬
3. Gateway Caches
   - 서버 앞 단에서 설치되어 요청에 대한 캐쉬 및 효율적인 분배를 통해 가용성, 신뢰성, 성능등을 향상
   - 무한대의 클라이언트들에게 한정된 수의 웹 서버 컨텐츠를 제공

### 어떻게 컨트롤 하나?

1. HTML Meta Tags

   > HTML Meta Tag를 페이지에 삽입하는 방법, 몇몇 브라우저에게만 유효 했으며 지금은 더 이상 사용하지 않는 방법입니다.

2. HTTP Headers

   > 파일이 이전과 비교하여 변경 되었는가를 체크하는 validation과 캐쉬의 만료 여부를 체크하는 freshness로 구성됩니다.

### 어떻게 캐쉬가 동작할까?

#### 첫 요청

1. 브라우저는 서버에 `index.html`파일을 요청합니다.
2. 서버는 `index.html`파일을 찾아보고 존재하는 파일이라면 파일 내용을 브라우저에게 몇 가지 `header`값과 함께 응답합니다.
3. 브라우저는 응답 받은 내용을 브라우저에 표시하고 응답 헤더 내용에 따라 캐쉬 정책을 수행합니다.

#### 재 요청

1. LAST-MODIFIED
   - 브라우저는 최초 응답 시 받은 Last-modified 값을 if-modified-since라는 헤더에 포함시켜 페이지를 요청
   - 서버는 요청파일의 수정 시간을 if-modified-since값과 비교하여 동일 하다면 304 not modified로 응답하고 다르다면 200 ok와 함게 새로운 last-modified값을 응답 헤더에 전송합니다.
   - 브라우저는 응답 코드가 304인 경우 캐쉬에서 페이지를 로드하고 200이라면 새로 다운 받은후 last-modified를 갱신합니다.
2. ETAG(ENTITY TAG)
   - 브라우저는 최초 응답 시 받은 Etag값을 if-none-match라는 헤더에 포함시켜 페이지를 요청합니다.
   - 서버는 요청 파일의 Etag값을 if-nono-match값과 교하여 동일하다면 304 not modified로 응답하고 다르다면 200 ok 와 함게 새로운 Etag 값을 응답헤더에 전송합니다.
   - 브라우저는 응답 코드가 304인경우 캐쉬에서 페이지를 로드하고 200이라면 새로 다운받은후 Etag값을 갱신합니다.
3. Expires
   - 브라우저는 최초 응답 시 받은 Expires 시간을 비교하여 기간 내라면 서버를 거치지 않고 바로 캐쉬에서 페이지를 로드합니다. 만약 기간이 만료되었다면 위에 설명한 validation 작업을 수행합니다.
4. Cache-Control
   - 브라우저는 최초 응답시 받은 Cache-Control 중 max-age값을 GMT와 비교하여 기간 내라면 서버를 거치지 않고 캐쉬에서 페이지를 로드 합니다. 만약 기간이 만료되었다면 validation 작업을 수행합니다.