## 운영체제

### 역할

1. CPU 스케줄링과 프로세스 관리 
2. 메모리 관리
3. 디스크 파일 관리
4. I/O 디바이스 관리

### 구조

GUI : 사용자가 전자장치와 상호작용할 수 있도록 하는 사용자 인터페이스의 한 형태

시스템콜 

커널 

드라이버 : 하드웨어를 제어하기 위한 드라이버

#### 시스템콜

운영체제가 커널에 접근하기 위한 인터페이스 이며 유저 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출할 때 씁니다.

이 과정을 통해 컴퓨터 자원에 대한 직접 접근을 차단할 수 있고 프로그램을 다른 프로그램으로부터 보호할 수 있습니다.

### 요소

#### CPU

산술논리연산장치, 제어장치, 레지스터로 구성되어 있는 컴퓨터 장치를 말하며 인터럽트에 의해 단순히 메모리에 존재하는 명령어를 해석해서 실행하는 일꾼입니다.

#### 제어장치

프로세스 조작을 지시하는 CPU의 한 부품입니다. 입출력장치 간 통신을 제어하고 명려어들을 일고 해석하며 데이터 처리를 위한 순서를 결정합니다.

#### 레지스터

CPU 안에 있늠 매우 빠른 임시기억 장치를 가리킵니다. CPU는 자체적으로 데이터를 저장할 방법이 없기 때문에 레지스터를 거쳐 데이터를 전달합니다.

#### 산술논리연산장치

### CPU에서 연산 처리

1. 제어장치가 메모리에 계산할 값을 로드합니다. 또한, 레지스터에도 로드합니다.
2. 제어장치가 레지스터에 있는 값을 계산하라고 산술논리 연산장치에 명령합니다.
3. 제어장치가 계산된 값을 다시 `레지스터에서 메모리`로 계산한 값을 저장합니다.

#### 인터럽트

어떤 신호가 들어왔을대 CPU장치를 잠깐 정지시키는 것을 말합니다.

### 메모리

CPU는 그저 메모리에 올라와 있는 프로그램의 명령어들을 실행할 뿐입니다. 메모리 계층과 메모리 관리를 알아보겠습니다.

#### 메모리 계층

레지스터: CPU 안에있는 작은 메모리

캐시 : L1, L2 캐시를 지칭

주기억장치 : RAM을 가르킴

보조기억장치 : HDD, SSD

위로 갈수록 속도는 빠르고 휘발성이 빠르고 용량은 작습니다.

이렇게 계층을 두어 필요한 부분에 사용하는 이유는 아래로 갈 수록 같은 크기 대비 가격 차이가 나기 때문입니다. 즉 경제성에 도움이 됩니다.

#### 캐시

데이터를 미리 복사해 놓은 임시저장소이자 빠른 장치와 느린장치에서 속도차이에 따른 병목현상을 줄이기 위한 메모리 입니다.

> 지역성의 원리
>
> 시간 지역성 : 최근에 사용한 데이터를 다시 접근하려는 특성
>
> 공간 지역성 : 최근에 사용한 데이터와 유사한 공간에 접근하려는 특성

캐시미스 : 캐시에서 원하는 데이터를 찾지 못함

캐시 히트: 캐시에서 원하는 데이터를 찾음.

#### 웹 브라우저에서의 캐시

쿠키: 만료기한이 있는 키-벨류 저장소입니다. 웹 서버에 요청 할 때 자동을 포함되어 전달됩니다. httponly를 거는것이 중요하며 만료기한을 정할 수 있습니다.

로컬스토리지 : 만료기한 없는 키-벨루 저장소이며 텝을 꺼도 지워지지 않습니다.

세션 스토리지: 만료기한이 없는 키-벨류 저장소이지만 텝을 끄면 지워집니다.

### 메모리 관리

#### 가상 메모리

메모리 관리 기법의 하나로 컴퓨터가 실제로 이용 가능한 메모리 자원을 추상화 하여 이를 사용하는 사용자들에게 매우 큰 메모리로 보이게 만드는 방법을 말합니다.

가상적으로 주어진 주소를 가상주소 라고 하며 가상 주소는 메모리관리 장치에 의해 실제 주소로 변환 되며 이 덕분에 사용자는 실제 주소에 의식할 필요 없이 프로그램을 구축할 수 있게 됩니다.

가상메모리는 가장주소와 실제 주소가 매핑되어 잇고 프로세스의 주소 정보가 들어있는 페이지 테이블로 관리 됩니다. 이때 성능향상을 위해 TLB를 사용합니다.

#### 스와핑

가상 메모리에는 존재하지만 실제 메모리에 존재하지 않는 경우 페이지 폴트가 발생합니다. 이를 방지하기 위해 당장 사용하지 않는 영역을 하드디스크로 옮겨 필요할때 다시  RAM에 옮기고 사용하지 않으면 다시 하드디스크로 내리는 것을 반복하여 RAM을 효과적으로 관리하는 것을 의미합니다.

#### 스레싱

페이지 폴트율이 높은것을 의미 컴퓨터의 성능저하를 초래합니다.

#### 페이지 교체 알고리즘

스아핑은 페이지 교체 알고리즘을 기반으로 일어납니다.

- 오프라인 알고리즘 : 먼 미래에 참조되는 페이지와 현재 할당하는 알고리즘이며 가장 좋은 방법이지만 우리는 미래에 어떤 페이지를 쓸지 알 수 없다.
- FIFO : 가장먼저 온 페이지를 먼저 교체한다.
- LRU : 참조가 가장 오래된 페이지를 바꿉니다. 그래서 페이지마다 계수기, 스택을 두어야한다.
- NUR : 최근에 참조된 데이터는 1, 그렇지 않은 데이터는 0으로 두고 시계 방향으로 돌면서 0을 만나면 교체하고 1로 바꾸는 알고리즘입니다.
- LFU : 가장 참조 횟수가 적은 페이지를 교체

## 프로세스와 스레드

프로세스는 실행되고 있는 프로그램을 의미하며 스레드는 프로세스의 작업 단위 입니다.

### 컴파일 과정

전처리 -> 컴파일러 -> 어셈블러 -> 링커

### 프로세스의 상태

- 생성 : 프로세스가 생성된 상태
- 대기 : CPU 스케줄러러 부터 CPU 소유권을 기다리는 상태
- 대기 중단 : 메모리 부족으로 일시 중단된 상태
- 실행 상태 : CPU 소유권과 메모리를 할당받고 인스트럭션을 수행 중인 상태를 의미합니다.
- 중단 상태 : 어떤 이벤트가 발생한 이후 기다리며 프로세스가 차단된 상태 입니다.
- 일시 중단 상태 : 대기 중단과 유사. 중단 상태 이후 메모리 부족으로 일시 중단된 상태
- 종료 상태 : CPU소유권과 메모리를 모두 놓고 가는 상태

### 메모리구조

#### 동적영역

- 스택 : 지역변수, 매개변수, 함수가 저장되고 컴파일 시에 크기가 결정되며 동적인 특징 스택 영역은 재귀적으로 호출하면서 동적으로 크기가 늘어 날 수 있는데 이때 힙과 스택의 메모리 영역이 겹치면 안되기 대문에 힙과 스택 사이의 공간을 비워 놓습니다.
- 힙 : 런타임시에 크기가 결정됩니다. 

#### 정적 영역

- 데이터 영역: 전역변수, 정적변수가 저장되고 프로그램이 종료되면 사라지는 변수가 들어 있는 영역입니다.
- 코드 영역 : 프로그램에 내장되어 있는 소스 코드가 들어가는 영역입니다.

### PCB

프로세스에 대한 메타 데이터를 저장한 데이터를 말합니다. 프로세스 제어 블록이라고도 합니다.

- 프로세스 스케줄링 상태
- 프로세스 ID
- 프로세스 권한
- 프로세스 카운터
- CPU 레지스터
- CPU 스케줄링 정보
- 계정정보
- I/O 상태 정보

#### 컨테스트 스위칭

앞서 말한 PCB를 교환하는 과정입니다. 실행하는 프로세스를 바꾸는 과정이라고 볼 수 있습니다.

### 멀티 프로세싱

여러 개의 프로세스 즉 멀티 프로세스를 통해 동시에 두 가지 이상의 일을 수행하는 것을 말합니다. 프로세스 중 일부가 고장 나더라도 다른 프로세스는 독립적으므로 영향을 받지 않는 특징이 있습니다.

### 스레드와 멀티 스레딩

스레드는 프로세스의 실행 가능한 작은 단위 입니다. 프로세스는 여러개의 스레드를 가질 수 있습니다.

#### 멀티 스레딩

프로세스 내 작업을 여러 개의 스레드 , 멀티스레드로 처리하는 기법이며 서로의 자원을 공유하기 대문에 효율성이 높습니다. 

하지만 한 스레드에 문제가 생기면 다른 스레드에도 영향을 끼쳐 문제가 될 수 있습니다.

### 공유자원과 임계 영역

공유자원은 시스템 안에서 각 프로세스, 스레드가 함게 접근할 수 있는 자원이나 변수등을 의미합니다.

임계 영역은 공유 자원에 접근할 대 순서 등의 이류로 결과가 달라지는 영역을 임계 영역이라고 합니다. 방법은 크게 뮤텍스, 세마포어, 모니터 세가지가 있으며 이 방법 모두 상호배제 한정대기 융통성이란 조건을 만족합니다.

이 방법의 토대가 되는 메커니즘은 잠금입니다.

> 상호배제
>
> 한 프로세스가 임계영역에 들어갓을때 다른 프로세스는 접근할 수 없다.
>
> 한정 대기
>
> 특정 프로세스가 영원히 임계 영역에 들어가지 못하면 안된다.
>
> 융통성
>
> 한 프로세스가 다른 프로세스의 일을 방해하면 안된다.

#### 뮤텍스

공유자원을 사용하기 전에 설정하고 사용한 후에 해제하는 잠금입니다.

#### 세마포어

일반화된 뮤텍스입니다.

#### 모니터

둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근할 수 있도록 공유 자원을 숨기고 해당 접근에 대해 인터페이스만 제공합니다.

### 교착상태

두 개 이상의 프로세스들이 서로를 가진 자원을 기다리며 중단된 상태

#### 원인

- 상호배제 : 한 프로세스가 자원을 독점하고 있으면 다른 프로세스는 접근 불가능
- 점유대기 : 특정 프로세스가 점유하고 있는 자원을 다른 프로세스가 요청
- 비선점: 다른 프로세스가 강제로 자원을 가져올 수 없음
- 환형대기 : A라는 프로세스가 자원 A를 점유하고 자원 B를 요청하고 B라는 프로세스가 자원 B를 점유하고 자원 A를 요청하므로 서로 자원의 원하는 상태

#### 해결방법

1. 애초에 교착상태가 되지 않게 설계
2. 교착 상태 가능성이 없을 때만 자원을 할당하며 프로세스당 요청할 자원들의 최대치를 통해 자원 할당 가능 여부를 파악
3. 교착 상태가 발생하면 사이클이 있는지 확인하고 프로세스 하나씩 제거한다.
4. 교착상태가 발생하면 해결하는데 처리하는 비용이 더 커서 사용자가 작업을 종료하기도 합니다.

### CPU 스케줄링 알고리즘

#### 비선점형 : CPU 스스로 점유권을 초기하는 방식 강제로 프로세스를 종류 시키지 않음.

- FCFS : 가장 먼저 온것을 가장 먼저 처리
- SJF : 실행시간이 짧은 프로세스를 먼저 실행
- 우선순위 : SJF에서 실행 시간이 긴 프로그램이 실행되지 않는 사태를 해결하기 위해 오래된 프로그램에 우선순위 부여

#### 선점형 : 알고리즘에 의해 중단 해버리고 강제로 다른 프로세스에 CPU 소유권 부여

- 라운드 로빈 : 각 프로세스는 동일한 할당 시간을 주고 그 시간안에 끝나지 않으면 다시 준비큐의 뒤로 가게하는 알고리즘
- SRF : SJF는 실행 시간이 더 짧은 작업이 들어와도 기존 짧은 작업을 모두 수행하고 그 다음 짧은 작업을 이어가는데 SRF는 중간에 더 짧은 작업이 들어오면 수행하던 프로세스를 중지하고 해당 프로세스를 수행하는 알고리즘 입니다.

- 다단계 큐 : 우선순위에 따른 준비 큐를 여러개 사용하고 큐 마다 다른 알고리즘을 적용한 것을 말합니다.

