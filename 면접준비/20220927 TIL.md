### 20220927 TIL

## TCP

### 3-way-handshake 연결

1. 클라이언트에서 서버에 접속 요청하는 `SYN(M)` 패킷 전송
2. 서버는 클라이언트의 `SYN(M)`패킷을 받고 `ACK(M+1)`패킷과 `SYN(N)` 전송
3. 클라이언트는 `SYN(N)`과 `ACK(M+1)`패킷을 받고 `ACK(N+1)`패킷을 전송

연결 완료

SYN패킷은 서로가 연결될 수 있는지 묻는 패킷이고 ACK패킷은 연결 될 수 있음을 알리는 패킷이다.

M과 N은 난수로 생성되는데 이는 이전 연결에 사용되었던 패킷때문에 일으킬 수 있는 문제를 최소화 하기 위함이다.

### 4-way-handshake 연결 해제

1. 클라이언트가 연결을 종료하겠다는 `FIN`플래그를 전송한다.

2. 서버는 클라이언트의 연결 해제 요청을 받고 확인 메시지로`ACK`를 보낸다.

   그리고 데이터 전송을 마저 다 할때까지 기다린다.

3. 데이터를 모두 보내면 통신이 끝났다는 의미로 클라이언트에게 `FIN`플래그를 전송한다.

4. 클라이언트는 `FIN`을 받고 확인 메시지로 `ACK`를 보낸다.

5. 서버는 `ACK`를 받고 연결은 닫는다.

6. 아직 미처 서버로 받지 못한 데이터가 있을 것을 대비해 일정 시간 세션을 남겨놓고 잉여 패킷을 기다리는 과정을 거친다.

## TCP / IP

인터넷 프로토콜 스위트는 인터넷과 이와 유사한 컴퓨터 네트워크 사이에서 정보를 주고받는데 이용되는 통신 프로토콜의 모음입니다. 

### TCP

전송제어 프로토콜의 약자이며 한 기기에서 다른 기기로 데이터를 전송하는 것을 담당합니다.

### IP

인터넷 프로토콜의 약자이며 데이터의 조각을 최대한 빨리 대상 IP 주소로 보내는 역할을 합니다.



데이터 전송 과정에서 TCP와 IP가 각각 담당하는 작업이 있지만 결국에는 같은 결과를 목표로 하기 때문에 함께 소개하기도 합니다.

### TCP/IP의 4계층

- 응용계층

  사용자가 상호작용하기 가장 쉬운 계층입니다. 응용계층은 사용자가 네트워크에 접근할 수 있도록 합니다. 게다가 사용자 인터페이스를 제공할 뿐만 아니라 이메일 원격파일 접근 및 전송 , 공유 데이터베이스 관리 등의 서비스를 제공 합니다.

- 전송계층

  전송계층이라는 이름에서 눈치 채셨겠지만, 전송 계층은 전송을 담당하는 계층입니다. 전송 계층에는 TCP 뿐만 아니라 UDP(사용자 데이터그램 통신 규약) 또한 있습니다.

  UDP는 TCP보다 단순하며 다른 데이터에 비해 안전하게 보호되어야 할 필요가 없는 실시간 응용 프로그램에서 이용됩니다. UDP는 TCP보다 신뢰도가 낮고 오류검출, 흐름제어 등의 기능을 제공하지 않아 패킷을 빠르게 전송하는 응용계층에서 이용됩니다.

- 인터넷 계층

  네크워크 간 데이터 패킷 전송을 관리합니다.

- 데이터 링크 계층

  데이터가 원하는 IP 주소에 도달할 뿐 만 아니라 해당 네트워크 내의 연결되어 있는지 확인하는 역할입니다. 원하는 기기의 MAC 주소를 확인하고 이더넷 케이블 및 와이파이를 통한 데이터 전송을 관리하는 작업도 담당합니다.

## HTTP / HTTPS

- HTTP는 평문 통신이기에 도청 가능하다.
- 통신 상대를 확인하지 않기 때문에 위장가능하다.
- 완전성을 증명할 수 없기 대문에 변조가 가능하다.

### TCP/IP는 도청이 가능하다.

TCP/IP 구조의 통신은 전부 통신 경로상에서 엿볼수가 있다. 패킷을 수집하는 것만으로도 도청할 수 있다. 평문으로 통신을 할 경우 메시지의 의미를 파악할 수 있기 때문에 암호화하여 통신해야 한다.

#### 보완 방법

- 통신 자체는 `SSL`, `TLS`라는 다른 프로토콜과 조합함으로써 통신내용을 암호화 할 수 있다. `SSL`을 조합한`HTTP`를 `HTTPS`라 부른다.
- 콘텐츠를 말 그대로 HTTP를 사용해서 운반하는 내용인 , HTTP메시지에 포함되는 콘텐츠만 암호화 하는 것이다. 암호화해서 전송하면 받은 측에서는 그 암호화를 해독하여 출력하는 처리가 필요하다.

HTTPS는 SSL의 껍질을 가진 HTTP라고 할 수 있다. HTTP는 SSL과 통신하고 SSL이 TCP와 통신을 하는 이런 형식을 가지게 된다.

## 웹통신의 큰 흐름

1. 브라우저

   1. url에 입력된 값을 내부의 규칙에 따라 그 의미를 조사

   2. 그 의미를 기반으로 HTTP Request 메시지 생성

   3. 만들어진 메시지를 웹 서버로 전송

      바로 전송하는 것이 아니라 도메인 명에 맞는 ip주소를 DNS서버를 통해 조회 하여 ip주소를 알아낸 후에 전송한다.

2. 웹 서버

   1. 패킷이 웹 서버에 도착하면 웹 서버의 프로토콜 스택은 패킷을 추출하여 메시지를 복원하고 웹 서버 애플리 케이션에 넘긴다.
   2. 메시지를 받은 엡서버 애플리케이션은 요청 메시지에 따른 데이터를 응답 메시지에 넣어 클라이언트로 회송한다.
   3. 왔던 방식대로 응답 메시지가 클라이언트에게 전달 된다.

   